C51 COMPILER V9.60.7.0   PROJETOC                                                          05/21/2024 16:31:54 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE PROJETOC
OBJECT MODULE PLACED IN .\Objects\ProjetoC.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ProjetoC.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -ProjetoC.lst) TABS(2) OBJECT(.\Objects\ProjetoC.obj)

line level    source

   1          #include <reg51.h>
   2          
   3          // Tempo inicial de 5.0 segundos
   4          #define TempoInicial 50
   5          // Valor da variavel 'conta' para 1 segundo
   6          #define segundo 4000
   7          
   8          /* 
   9          O valor maximo da contagem de tempo e "FF + 1" = 256 microsegundos (Timer no modo 2 tem 8 bits)
  10          Um cilo maquina tem 6 estados e cada estado tem 2 periodos do oscilador, logo 12 periodos
  11          Periodo = 1/12*(10^6) = 1/12 microsegundos , 1 ciclo maquina = 12*Periodo = 12*(1/12) = 1 microsegundo
  12          250 microsegundos : 256-250 = 6 = 6 microsegundos (Sendo 06 -> TH0 e 06 -> TL0)
  13          */
  14          #define TempoH 0x06
  15          #define TempoL 0x06
  16          
  17          /*
  18          Da inicio a contagem decrescente para o participante responder (Caso o tempo para a contagem esteja a ser 
             -mostrado nos displays com o tempo inicial de 5.0 segundos)
  19          Repoe a visualizacao do tempo inicial de 5.0 segundos nos displays (Caso a informacao com o tempo/resposta
             - do participante esteja a ser mostrada nos displays)
  20          */
  21          sbit B1 = P3^2;
  22          
  23          /*
  24          Ao ser pressionado qualquer um dos botoes de opcao de resposta ha uma transicao logica de 1 para 0
  25          Enquanto qualquer um dos botoes de opcao de resposta continuar pressionado, e colocado o valor logico 0
  26          */
  27          sbit Pressionado = P3^3;
  28          
  29          // Opcoes de resposta
  30          sbit BA = P3^4;
  31          sbit BB = P3^5;
  32          sbit BC = P3^6;
  33          sbit BD = P3^7;
  34          
  35          // Display D1
  36          sbit D1A = P1^0;
  37          sbit D1B = P1^1;
  38          sbit D1C = P1^2;
  39          sbit D1D = P1^3;
  40          sbit D1E = P1^4;
  41          sbit D1F = P1^5;
  42          sbit D1G = P1^6;
  43          sbit D1DF = P1^7;
  44          
  45          // Display D2
  46          sbit D2A = P2^0;
  47          sbit D2B = P2^1;
  48          sbit D2C = P2^2;
  49          sbit D2D = P2^3;
  50          sbit D2E = P2^4;
  51          sbit D2F = P2^5;
  52          sbit D2G = P2^6;
C51 COMPILER V9.60.7.0   PROJETOC                                                          05/21/2024 16:31:54 PAGE 2   

  53          sbit D2DF = P2^7;
  54          
  55          //conta = 1 -> 250 microsegundos
  56          //conta = 400 -> 0.1 segundo
  57          unsigned int conta = 0;
  58          // Tempo inicial de 5.0 segundos
  59          int segundosIniciais = TempoInicial;
  60          // Resposta do participante (1->A, 2->B, 3->C ou 4->D)
  61          int resposta = 0;
  62          
  63          // Esta a '0' se esta a ser mostrado o tempo inicial nos displays (Nao foi clicado no botao B1)
  64          // Esta a '1' se informa��o com o tempo/resposta do participante esteja a ser mostrada nos displays (J
             -a foi clicado no botao B1)
  65          bit clicouB1 = 0;
  66          // Esta a '0' se o participante ainda nao respondeu (Não clicou numa das opcoes de resposta durante os 5.
             -0 segundos)
  67          // Esta a '1' se o participante ja respondeu (Clicou numa das opcoes de resposta durante os 5.0 segundos)
  68          bit respondeu = 0;
  69          
  70          // Segmentos dos displays com todos os numeros, simbolos e letras
  71          code unsigned segments[22][8] = {
  72            {1, 1, 1, 1, 1, 1, 0, 0}, // -.
  73            {0, 0, 0, 0, 0, 0, 1, 0}, // 0.
  74            {1, 0, 0, 1, 1, 1, 1, 0}, // 1.
  75            {0, 0, 1, 0, 0, 1, 0, 0}, // 2.
  76            {0, 0, 0, 0, 1, 1, 0, 0}, // 3.
  77            {1, 0, 0, 1, 1, 0, 0, 0}, // 4.
  78            {0, 1, 0, 0, 1, 0, 0, 0}, // 5.
  79            {1, 1, 1, 1, 1, 1, 0, 1}, // -
  80            {0, 0, 0, 0, 0, 0, 1, 1}, // 0
  81            {1, 0, 0, 1, 1, 1, 1, 1}, // 1
  82            {0, 0, 1, 0, 0, 1, 0, 1}, // 2
  83            {0, 0, 0, 0, 1, 1, 0, 1}, // 3
  84            {1, 0, 0, 1, 1, 0, 0, 1}, // 4
  85            {0, 1, 0, 0, 1, 0, 0, 1}, // 5
  86            {0, 1, 0, 0, 0, 0, 0, 1}, // 6
  87            {0, 0, 0, 1, 1, 1, 1, 1}, // 7
  88            {0, 0, 0, 0, 0, 0, 0, 1}, // 8
  89            {0, 0, 0, 0, 1, 0, 0, 1}, // 9
  90            {0, 0, 0, 1, 0, 0, 0, 1}, // A
  91            {1, 1, 0, 0, 0, 0, 0, 1}, // B
  92            {0, 1, 1, 0, 0, 0, 1, 1}, // C
  93            {1, 0, 0, 0, 0, 1, 0, 1}, // D
  94          };
  95          
  96          // Inicializacao do sistema
  97          void Init (void)
  98          {
  99   1        // Configuracao do registo
 100   1        EA = 1; // Ativa as interrupcoes globais
 101   1        ET0 = 1; // Ativa a interrupcao timer 0
 102   1        EX0 = 1; // Ativa a interrupcao externa 0
 103   1        EX1 = 1; // Ativa a interrupcao externa 1
 104   1        
 105   1        // Timer no modo 2, de 8 bits com auto-reload
 106   1        TMOD &= 0xF0; // Limpa os bits menos significativos
 107   1        TMOD |= 0x02; // Timer 0 no modo 2
 108   1        
 109   1        TH0 = TempoH;
 110   1        TL0 = TempoL;
 111   1        
 112   1        IT0 = 1; // Interrupcao externa 0 activa a falling edge
C51 COMPILER V9.60.7.0   PROJETOC                                                          05/21/2024 16:31:54 PAGE 3   

 113   1        IT1 = 1; // Interrupcao externa 1 activa a falling edge
 114   1        TR0 = 0; // Timer 0 nao comeca
 115   1      }
 116          
 117          // Interrupcao externa 0
 118          void External0 (void) interrupt 0 
 119          {
 120   1        // Se o botao B1 foi clicado
 121   1        if(clicouB1){
 122   2          TR0 = 0; // Timer0 para de contar o tempo
 123   2          segundosIniciais = TempoInicial;
 124   2          conta = 0;
 125   2          clicouB1 = 0;
 126   2        } 
 127   1        else {
 128   2          TR0 = 1; // Timer0 comeca a contar tempo
 129   2          clicouB1 = 1;
 130   2        }
 131   1      }
 132          
 133          // Interrupcao externa 1
 134          void External1 (void) interrupt 2
 135          {
 136   1        while(!Pressionado && segundosIniciais != TempoInicial && segundosIniciais != 0){
 137   2          if (!BA){
 138   3            respondeu = 1;
 139   3            resposta = 1;
 140   3          } else if (!BB){
 141   3            respondeu = 1;
 142   3            resposta = 2;
 143   3          } else if (!BC){
 144   3            respondeu = 1;
 145   3            resposta = 3;
 146   3          } else if (!BD){
 147   3            respondeu = 1;
 148   3            resposta = 4;
 149   3          }
 150   2        }
 151   1      }
 152          
 153          void Timer0_ISR (void) interrupt 1 
 154          {
 155   1        conta++;
 156   1      
 157   1        if (!respondeu){
 158   2          if (conta == 400){
 159   3            segundosIniciais--;
 160   3            conta=0;
 161   3          }
 162   2        }
 163   1      }
 164          
 165          void display (int num1, int num2)
 166          {
 167   1        D1A = segments[num1][0];
 168   1        D1B = segments[num1][1];
 169   1        D1C = segments[num1][2];
 170   1        D1D = segments[num1][3];
 171   1        D1E = segments[num1][4];
 172   1        D1F = segments[num1][5];
 173   1        D1G = segments[num1][6];
 174   1        D1DF = segments[num1][7];
C51 COMPILER V9.60.7.0   PROJETOC                                                          05/21/2024 16:31:54 PAGE 4   

 175   1      
 176   1        D2A = segments[num2][0];
 177   1        D2B = segments[num2][1];
 178   1        D2C = segments[num2][2];
 179   1        D2D = segments[num2][3];
 180   1        D2E = segments[num2][4];
 181   1        D2F = segments[num2][5];
 182   1        D2G = segments[num2][6];
 183   1        D2DF = segments[num2][7];
 184   1      }
 185          
 186          void displaySegundos (int num)
 187          {
 188   1          int dezenas = num / 10;
 189   1          int unidades = num % 10;
 190   1      
 191   1          display(dezenas+1, unidades+8);
 192   1      }
 193          
 194          void semResposta (void)
 195          {
 196   1        conta = 0;
 197   1        respondeu = 1;
 198   1        display(1, 8);
 199   1        TR0 = 1;
 200   1        
 201   1        do {
 202   2      
 203   2          // Verifica se o tempo excedeu o limite
 204   2          if (conta == segundo) {
 205   3              display(0, 7); // Exibir algo indicando que o tempo acabou (ou sem resposta)
 206   3              TR0 = 0; // Parar o timer
 207   3          }
 208   2        } while (B1); // Continua no loop enquanto B1 est� em n�vel alto (n�o pressionado)
 209   1        
 210   1        conta = 0;
 211   1        respondeu = 0;
 212   1      }
 213          
 214          void mostraInformacao(void)
 215          {
 216   1        bit opcao = 0;
 217   1        conta = 0;
 218   1        TR0 = 1;
 219   1        
 220   1        while (B1){
 221   2          if (conta == segundo){
 222   3            if (opcao == 0){
 223   4              displaySegundos(segundosIniciais);
 224   4              opcao = 1;
 225   4            } else {
 226   4              display(0, resposta+17);
 227   4              opcao = 0;
 228   4            }
 229   3            conta = 0;
 230   3          }
 231   2        }
 232   1        
 233   1        TR0 = 0;
 234   1        conta = 0;
 235   1        respondeu = 0;
 236   1      }
C51 COMPILER V9.60.7.0   PROJETOC                                                          05/21/2024 16:31:54 PAGE 5   

 237          
 238          void main (void)
 239          {
 240   1        Init();
 241   1        
 242   1        while(1){
 243   2          
 244   2          displaySegundos(segundosIniciais);
 245   2          
 246   2          if (segundosIniciais <= 0){
 247   3            semResposta();
 248   3          }
 249   2      
 250   2          if (respondeu && segundosIniciais < TempoInicial){
 251   3            mostraInformacao();
 252   3          }
 253   2        }
 254   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    998    ----
   CONSTANT SIZE    =    352    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
